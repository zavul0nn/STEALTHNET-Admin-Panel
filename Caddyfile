# Caddyfile для StealthNET
# Caddy автоматически получает SSL сертификаты через Let's Encrypt

# Замените your-domain.com на ваш домен
# Для локальной разработки используйте localhost или IP адрес

# Вариант 1: С доменом (автоматический SSL)
# your-domain.com {
#     # Логирование
#     log {
#         output file /var/log/caddy/access.log
#         format json
#     }
#
#     # Frontend (React)
#     root * /usr/share/caddy
#     file_server
#     try_files {path} /index.html
#
#     # API проксирование
#     reverse_proxy /api/* api:5000 {
#         header_up X-Real-IP {remote_host}
#         header_up X-Forwarded-For {remote_host}
#         header_up X-Forwarded-Proto {scheme}
#         transport http {
#             read_timeout 300s
#             dial_timeout 10s
#         }
#     }
#
#     # Мини-приложение Telegram
#     handle /miniapp/* {
#         root * /usr/share/caddy
#         file_server
#         try_files {path} /miniapp/index.html
#     }
#
#     # Статические файлы с кешированием
#     handle /static/* {
#         root * /usr/share/caddy
#         file_server
#         header Cache-Control "public, max-age=31536000, immutable"
#     }
#
#     # Локализация
#     handle /locales/* {
#         root * /usr/share/caddy
#         file_server
#         header Cache-Control "public, max-age=86400"
#     }
# }

# Вариант 2: Без домена (HTTP, для разработки)
:80 {
    # Логирование
    log {
        output stdout
        format console
    }

    # Frontend (React)
    root * /usr/share/caddy
    file_server
    try_files {path} /index.html

    # API проксирование
    reverse_proxy /api/* api:5000 {
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        transport http {
            read_timeout 300s
            dial_timeout 10s
        }
    }

    # Мини-приложение Telegram
    handle /miniapp/* {
        root * /usr/share/caddy
        file_server
        try_files {path} /miniapp/index.html
    }

    # Статические файлы с кешированием
    handle /static/* {
        root * /usr/share/caddy
        file_server
        header Cache-Control "public, max-age=31536000, immutable"
    }

    # Локализация
    handle /locales/* {
        root * /usr/share/caddy
        file_server
        header Cache-Control "public, max-age=86400"
    }
}

# Вариант 3: С IP адресом (для тестирования)
# :80 {
#     bind 0.0.0.0
#     
#     # Остальная конфигурация как в варианте 2
#     root * /usr/share/caddy
#     file_server
#     try_files {path} /index.html
#     
#     reverse_proxy /api/* api:5000 {
#         header_up X-Real-IP {remote_host}
#         header_up X-Forwarded-For {remote_host}
#         header_up X-Forwarded-Proto {scheme}
#     }
# }

