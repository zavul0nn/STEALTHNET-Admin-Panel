<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2481cc">
    <title>StealthNET</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #1a1a2e;
            --tg-theme-hint-color: #6b7280;
            --tg-theme-link-color: #3f69ff;
            --tg-theme-button-color: #3f69ff;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f8fafc;
            
            --primary: #3f69ff;
            --primary-rgb: 63, 105, 255;
            --primary-glow: rgba(63, 105, 255, 0.4);
            --primary-dark: #2a58f0;
            --primary-hover: #2a58f0;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            
            --bg-primary: #f8fafc;
            --bg-secondary: #eef2ff;
            --body-bg: linear-gradient(180deg, #f8fafc 0%, #eef2ff 35%, #e0e7ff 100%);
            
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(15, 23, 42, 0.08);
            --glass-blur: saturate(180%) blur(18px);
            --bg-glass: var(--glass-bg);
            
            --border-color: var(--glass-border);
            --border-glow: rgba(63, 105, 255, 0.3);
            
            --shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
            
            --radius: 12px;
            --radius-lg: 24px;
            
            --success: #22c55e;
            --accent-green: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --accent-red: #ef4444;
            --accent-orange: #fb923c;
            
            --surface-muted: rgba(15, 23, 42, 0.04);
            --surface-strong: rgba(63, 105, 255, 0.12);
            --gradient-primary: radial-gradient(circle at 15% 20%, rgba(63, 105, 255, 0.25), transparent 55%);
        }

        :root[data-theme="dark"] {
            color-scheme: dark;
            --tg-theme-bg-color: #050816;
            --tg-theme-text-color: #e2e8f0;
            --tg-theme-hint-color: #94a3b8;
            --tg-theme-link-color: #6c7bff;
            --tg-theme-button-color: #6c7bff;
            --tg-theme-button-text-color: #0a0e1a;
            --tg-theme-secondary-bg-color: rgba(15, 23, 42, 0.6);
            
            --primary: #6c7bff;
            --primary-rgb: 108, 123, 255;
            --primary-glow: rgba(108, 123, 255, 0.6);
            --primary-dark: #5a6aff;
            --primary-hover: #8b9dff;
            --secondary: #a855f7;
            --accent: #ff00ff;
            
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            
            --bg-primary: #050816;
            --bg-secondary: #0f172a;
            --body-bg: radial-gradient(circle at 20% 20%, rgba(63, 105, 255, 0.25), transparent 45%), #050816;
            
            --glass-bg: rgba(11, 15, 25, 0.92);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: saturate(180%) blur(18px);
            --bg-glass: var(--glass-bg);
            
            --border-color: var(--glass-border);
            --border-glow: rgba(108, 123, 255, 0.3);
            
            --shadow: 0 25px 60px rgba(0, 0, 0, 0.45);
            --shadow-sm: 0 2px 12px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
            
            --success: #4ade80;
            --accent-green: #4ade80;
            --warning: #facc15;
            --danger: #f87171;
            --accent-red: #f87171;
            --accent-orange: #fb923c;
            
            --surface-muted: rgba(255, 255, 255, 0.05);
            --surface-strong: rgba(108, 99, 255, 0.15);
            --gradient-primary: radial-gradient(circle at 20% 15%, rgba(108, 99, 255, 0.35), transparent 60%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--body-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
            background-attachment: fixed;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px;
            padding-bottom: 100px;
            position: relative;
            z-index: 1;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            gap: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .gradient-card {
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(135deg, rgba(63, 105, 255, 0.18), rgba(14, 165, 233, 0.15));
        }
        
        .gradient-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-primary);
            opacity: 0.35;
            pointer-events: none;
        }
        
        .gradient-card > * {
            position: relative;
            z-index: 1;
        }
        
        .accent-card {
            background-image: linear-gradient(135deg, rgba(63, 105, 255, 0.07), rgba(14, 165, 233, 0.05));
        }
        
        .softer-card {
            background: var(--glass-bg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .client-widget-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 18px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status-active {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }
        
        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .status-chip.success {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }
        
        .status-chip.danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0;
            border: none;
            margin-bottom: 18px;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }
        
        .info-list.modern {
            display: flex;
            flex-direction: column;
            gap: 18px;
            margin-top: 18px;
        }
        
        .info-item.modern {
            border: none;
            padding: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-value {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }
        
        .text-warning {
            color: var(--accent-orange);
        }

        .btn {
            background: var(--primary);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 999px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-top: 12px;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--surface-muted);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--surface-strong);
        }
        
        .btn-ghost {
            padding: 10px 18px;
            border-radius: 999px;
            border: 1px solid var(--glass-border);
            background: var(--surface-muted);
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            color: var(--text-primary);
        }
        
        .btn-ghost:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--surface-strong);
        }

        .tariff-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .tariff-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .tariff-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .tariff-card.selected {
            border-color: var(--primary);
            background: var(--surface-strong);
            box-shadow: var(--shadow-md);
        }

        .tariff-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
        }

        .tariff-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .tariff-duration {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.2;
        }

        .tariff-price {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            text-align: right;
            white-space: nowrap;
            margin-left: 16px;
        }

        .server-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: none;
            overflow-y: auto;
            margin-top: 12px;
        }

        .server-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .server-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .server-region {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .server-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-green);
            box-shadow: 0 0 10px currentColor;
            color: var(--accent-green);
        }

        .server-status.offline {
            background: var(--accent-red);
            color: var(--accent-red);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor;
        }
        
        .status-dot.online {
            background: var(--accent-green);
            color: var(--accent-green);
        }
        
        .status-dot.offline {
            background: var(--accent-red);
            color: var(--accent-red);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 24px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .payment-method {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .payment-method:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .hidden {
            display: none;
        }

        .error {
            color: var(--danger);
            text-align: center;
            padding: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
        }

        .expandable-section {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .expandable-section.collapsed {
            max-height: 0;
        }

        .expandable-section.expanded {
            max-height: 2000px;
        }

        .expand-toggle {
            cursor: pointer;
            user-select: none;
            transition: transform 0.3s ease;
        }

        .expand-toggle.expanded {
            transform: rotate(180deg);
        }

        .floating-button {
            position: fixed;
            bottom: 160px;
            left: 0;
            right: 0;
            margin: 0 auto;
            z-index: 1000;
            max-width: calc(100% - 40px);
            width: 100%;
            box-shadow: var(--shadow-lg);
            animation: float 3s ease-in-out infinite;
            transform: none;
        }

        .input-with-button {
            display: flex;
            align-items: stretch;
            gap: 8px;
            width: 100%;
        }

        .input-with-button input {
            flex: 1;
            min-width: 0;
        }

        .input-with-button button {
            flex-shrink: 0;
            margin: 0;
            width: auto;
            min-width: 60px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-top: 1px solid var(--glass-border);
            padding: 12px 0;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .bottom-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 480px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: var(--radius);
            transition: all 0.2s;
            color: var(--text-secondary);
            flex: 1;
            text-align: center;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(var(--primary-rgb), 0.1);
        }

        .nav-item-icon {
            font-size: 24px;
        }

        .nav-item-label {
            font-size: 12px;
            font-weight: 600;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        #pageTariffs {
            padding-bottom: 80px;
        }

        .branding-header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .branding-logo {
            max-width: 120px;
            max-height: 120px;
            margin: 0 auto 12px;
            display: block;
        }

        .branding-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .branding-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div id="content" class="hidden">
            <!-- –ë—Ä–µ–Ω–¥–∏–Ω–≥ -->
            <div id="brandingHeader" class="branding-header hidden">
                <img id="brandingLogo" class="branding-logo" src="" alt="" style="display: none;">
                <div id="brandingTitle" class="branding-title"></div>
                <div id="brandingSubtitle" class="branding-subtitle"></div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div id="pageInfo" class="page active" style="padding-bottom: 100px;">
                <div class="card glass-card gradient-card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>üìä</span> <span id="subscriptionStatusTitle">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏</span>
                        </div>
                        <span id="subscriptionStatus" class="status-badge status-inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                    </div>
                    <div class="info-list modern">
                        <div class="info-item modern">
                            <span class="info-label">‚è∞ <span id="expiresLabel">–ò—Å—Ç–µ–∫–∞–µ—Ç:</span></span>
                            <span id="expireDate" class="info-value">-</span>
                        </div>
                        <div class="info-item modern">
                            <span class="info-label">‚è≥ <span id="daysLeftLabel">–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π:</span></span>
                            <span id="daysLeft" class="info-value">-</span>
                        </div>
                        <div class="info-item modern">
                            <span class="info-label">üìä <span id="trafficLabel">–¢—Ä–∞—Ñ–∏–∫:</span></span>
                            <span id="traffic" class="info-value">-</span>
                        </div>
                    </div>
                    <div id="trafficProgress" class="progress-bar hidden" style="margin-top: 18px;">
                        <div id="trafficProgressFill" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ -->
                <div class="card glass-card info-card accent-card">
                    <h3 class="client-widget-title" id="loginDataTitle">–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞</h3>
                    <div class="info-list modern">
                        <div class="info-item modern">
                            <span class="info-label">üìß <span id="emailLabel">Email:</span></span>
                            <span id="userEmail" class="info-value">-</span>
                        </div>
                        <div class="info-item modern">
                            <span class="info-label">üîë <span id="passwordLabel">–ü–∞—Ä–æ–ª—å:</span></span>
                            <span id="userPassword" class="info-value">-</span>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–æ–º–æ–∫–æ–¥ -->
                <div class="card glass-card info-card softer-card promo-card">
                    <h3 class="client-widget-title" id="promoActivationTitle">–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</h3>
                    <div class="promo-section">
                        <div class="input-with-button">
                            <input 
                                type="text" 
                                id="promoCodeInput" 
                                placeholder=""
                                id="promoCodeInputPlaceholder" 
                                style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary);"
                            />
                            <button 
                                class="btn" 
                                onclick="activatePromoCode()" 
                                id="promoActivateBtn"
                                style="padding: 12px 20px;"
                            >
                                <span id="promoOkBtn">OK</span>
                            </button>
                        </div>
                        <div id="promoStatus" style="margin-top: 10px; font-size: 14px;"></div>
                    </div>
                </div>

                <!-- –†–µ—Ñ–µ—Ä–∞–ª–∫–∞ -->
                <div class="card glass-card info-card softer-card">
                    <h3 class="client-widget-title" id="referralProgramTitle">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                    <div class="referral-section">
                        <div class="input-with-button">
                            <input 
                                type="text" 
                                id="referralLinkInput" 
                                readonly
                                style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary);"
                            />
                            <button 
                                class="btn" 
                                onclick="copyReferralLink()" 
                                id="referralCopyBtn"
                                style="padding: 12px 20px;"
                            >
                                üìã
                            </button>
                        </div>
                        <div id="shareLinkText" style="margin-top: 10px; font-size: 13px; color: var(--text-secondary);">
                            –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å—ã!
                        </div>
                    </div>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–í–∞–ª—é—Ç–∞ –∏ –Ø–∑—ã–∫) -->
                <div class="card glass-card info-card softer-card">
                    <h3 class="client-widget-title" id="settingsTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                    <div class="settings-section" style="padding: 16px;">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary); font-weight: 600;">
                                üí± –í–∞–ª—é—Ç–∞
                            </label>
                            <select 
                                id="currencySelect" 
                                onchange="changeCurrency()"
                                style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary); font-size: 14px;"
                            >
                                <option value="uah">‚Ç¥ UAH</option>
                                <option value="rub">‚ÇΩ RUB</option>
                                <option value="usd">$ USD</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary); font-weight: 600;">
                                üåê –Ø–∑—ã–∫
                            </label>
                            <select 
                                id="languageSelect" 
                                onchange="changeLanguage()"
                                style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary); font-size: 14px;"
                            >
                                <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                <option value="ua">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                                <option value="en">üá¨üáß English</option>
                                <option value="cn">üá®üá≥ ‰∏≠Êñá</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã -->
            <div id="pageServers" class="page">
                <div class="card glass-card gradient-card">
                    <h3 class="client-widget-title" id="serversTitle">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã</h3>
                    <div id="serversList" class="server-list">
                        <div class="error" id="serversLoadingText"></div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –¢–∞—Ä–∏—Ñ—ã -->
            <div id="pageTariffs" class="page" style="padding-bottom: 80px;">
                <!-- –ü—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤ -->
                <div class="card" style="margin-bottom: 16px;">
                    <div class="card-header">
                        <div class="card-title">
                            <span>üé´</span> <span id="promoCodeTitle">–ü—Ä–æ–º–æ–∫–æ–¥</span>
                        </div>
                    </div>
                    <div class="promo-section">
                        <div class="input-with-button">
                            <input 
                                type="text" 
                                id="tariffPromoCodeInput" 
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" 
                                style="flex: 1; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary);"
                                onkeypress="if(event.key === 'Enter') checkTariffPromoCode()"
                            />
                            <button 
                                class="btn" 
                                onclick="checkTariffPromoCode()" 
                                id="tariffPromoCheckBtn"
                                style="margin-left: 8px; padding: 12px 20px;"
                            >
                                –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                            </button>
                        </div>
                        <div id="tariffPromoStatus" style="margin-top: 10px; font-size: 14px;"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>üíé</span> –¢–∞—Ä–∏—Ñ—ã
                        </div>
                    </div>
                    <div id="tariffsList" class="tariff-grid">
                        <div class="error" id="tariffsLoadingText"></div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 4: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
            <div id="pageSupport" class="page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span>üí¨</span> –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                        </div>
                    </div>
                    <div id="supportContent">
                        <!-- –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ -->
                        <div id="ticketsList" style="margin-bottom: 20px;">
                            <div class="error" id="ticketsLoadingText"></div>
                        </div>
                        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞ -->
                        <div id="createTicketForm" class="card" style="margin-top: 16px;">
                            <div class="card-header">
                                <div class="card-title">
                                    <span>‚ûï</span> <span id="createTicketText"></span>
                                </div>
                            </div>
                            <div style="padding: 16px;">
                                <input 
                                    type="text" 
                                    id="ticketSubject" 
                                    placeholder="–¢–µ–º–∞ —Ç–∏–∫–µ—Ç–∞" 
                                    style="width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary);"
                                />
                                <textarea 
                                    id="ticketMessage" 
                                    placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" 
                                    rows="4"
                                    style="width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); background: var(--bg-secondary); color: var(--text-primary); resize: vertical;"
                                ></textarea>
                                <button 
                                    class="btn" 
                                    onclick="createTicket()" 
                                    style="width: 100%;"
                                >
                                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="hidden error">
            <div id="errorLoadingText"></div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="bottom-nav">
        <div class="bottom-nav-items">
            <div class="nav-item active" onclick="switchPage('info')" id="navInfo">
                <div class="nav-item-icon">üìä</div>
                <div class="nav-item-label">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
            </div>
            <div class="nav-item" onclick="switchPage('servers')" id="navServers">
                <div class="nav-item-icon">üåê</div>
                <div class="nav-item-label">–°–µ—Ä–≤–µ—Ä—ã</div>
            </div>
            <div class="nav-item" onclick="switchPage('tariffs')" id="navTariffs">
                <div class="nav-item-icon">üíé</div>
                <div class="nav-item-label">–¢–∞—Ä–∏—Ñ—ã</div>
            </div>
            <div class="nav-item" onclick="switchPage('support')" id="navSupport">
                <div class="nav-item-icon">üí¨</div>
                <div class="nav-item-label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞ -->
    <div id="tariffsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="selectTariffTitle"></div>
                <button class="close-btn" onclick="closeTariffsModal()">√ó</button>
            </div>
            <div id="tariffsModalList" class="tariff-grid"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="selectPaymentTitle"></div>
                <button class="close-btn" onclick="closePaymentModal()">√ó</button>
            </div>
            <div id="paymentMethodsList" class="payment-methods"></div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        let userData = null;
        let tariffs = [];
        let servers = [];
        let selectedTariffId = null;
        let paymentMethods = [];
        let branding = {};
        let serversExpanded = false;
        let currentPage = 'info';
        let appliedPromo = null; // –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤
        let tickets = []; // –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤
        let serverDomain = 'panel.stealthnet.app'; // –î–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∏
        let currentCurrency = 'uah'; // –¢–µ–∫—É—â–∞—è –≤–∞–ª—é—Ç–∞
        let currentLanguage = 'ru'; // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫

        // –ü–µ—Ä–µ–≤–æ–¥—ã
        const translations = {
            ru: {
                loading: '–ó–∞–≥—Ä—É–∑–∫–∞...',
                subscriptionStatus: '–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏',
                active: '–ê–∫—Ç–∏–≤–Ω–∞',
                inactive: '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞',
                expires: '–ò—Å—Ç–µ–∫–∞–µ—Ç:',
                daysLeft: '–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π:',
                traffic: '–¢—Ä–∞—Ñ–∏–∫:',
                unlimited: '–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π',
                expired: '–ò—Å—Ç–µ–∫–ª–∞',
                days: '–¥–Ω.',
                loginData: '–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞',
                email: 'Email:',
                password: '–ü–∞—Ä–æ–ª—å:',
                notAvailable: '–ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω',
                promoActivation: '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞',
                enterCode: '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥...',
                promoCode: '–ü—Ä–æ–º–æ–∫–æ–¥',
                apply: '–ü—Ä–∏–º–µ–Ω–∏—Ç—å',
                referralProgram: '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
                shareLink: '–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å—ã!',
                referralCodeNotFound: '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω',
                linkCopied: '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!',
                settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                currency: '–í–∞–ª—é—Ç–∞',
                language: '–Ø–∑—ã–∫',
                servers: '–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã',
                serversLoading: '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤...',
                serversNotFound: '–°–µ—Ä–≤–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',
                activateSubscription: '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤',
                tariffs: '–¢–∞—Ä–∏—Ñ—ã',
                tariffsLoading: '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤...',
                tariffsNotFound: '–¢–∞—Ä–∏—Ñ—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',
                selectTariff: '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ',
                selectPayment: '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã',
                support: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
                info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
                myTickets: '–ú–æ–∏ —Ç–∏–∫–µ—Ç—ã',
                noTickets: '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤',
                createTicket: '–°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç',
                ticketSubject: '–¢–µ–º–∞ —Ç–∏–∫–µ—Ç–∞',
                message: '–°–æ–æ–±—â–µ–Ω–∏–µ',
                send: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
                connect: '–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è',
                error: '–û—à–∏–±–∫–∞',
                errorLoading: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö',
                errorLoadingServers: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤',
                errorLoadingTickets: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤',
                fillAllFields: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è',
                ticketCreated: '–¢–∏–∫–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!',
                errorCreatingTicket: '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞',
                currencyChanged: '–í–∞–ª—é—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞',
                languageChanged: '–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω',
                promoActivated: '–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω',
                promoError: '–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞',
                promoApplied: '–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω',
                promoInvalid: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥',
                basic: '–ë–∞–∑–æ–≤—ã–π',
                premium: '–ü—Ä–µ–º–∏—É–º',
                elite: '–≠–ª–∏—Ç–Ω—ã–π',
                daysWord: '–¥–Ω–µ–π',
                ticket: '–¢–∏–∫–µ—Ç',
                ticketNum: '–¢–∏–∫–µ—Ç #',
                open: '–û—Ç–∫—Ä—ã—Ç',
                closed: '–ó–∞–∫—Ä—ã—Ç',
                ok: 'OK',
                errorAuth: '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏',
                errorPayment: '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞',
                errorCopy: '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è',
                errorPromoCheck: '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞',
                promoAppliedWithDiscount: '–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω! –°–∫–∏–¥–∫–∞',
                promoDaysActivate: '–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –¥–Ω–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥–ø–∏—Å–∫–∏',
                enterPromoCode: '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥',
                viewTicketOnSite: '–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç',
                errorGettingToken: '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞',
                noAuthData: '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏',
                errorLoadingSubscription: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–∫–∏'
            },
            ua: {
                loading: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...',
                subscriptionStatus: '–°—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å–∫–∏',
                active: '–ê–∫—Ç–∏–≤–Ω–∞',
                inactive: '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞',
                expires: '–ó–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è:',
                daysLeft: '–ó–∞–ª–∏—à–∏–ª–æ—Å—å –¥–Ω—ñ–≤:',
                traffic: '–¢—Ä–∞—Ñ—ñ–∫:',
                unlimited: '–ë–µ–∑–ª—ñ–º—ñ—Ç–Ω–∏–π',
                expired: '–ó–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å',
                days: '–¥–Ω.',
                loginData: '–î–∞–Ω—ñ –¥–ª—è –≤—Ö–æ–¥—É',
                email: 'Email:',
                password: '–ü–∞—Ä–æ–ª—å:',
                notAvailable: '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π',
                promoActivation: '–ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ø—Ä–æ–º–æ–∫–æ–¥—É',
                enterCode: '–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥...',
                promoCode: '–ü—Ä–æ–º–æ–∫–æ–¥',
                apply: '–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏',
                referralProgram: '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞',
                shareLink: '–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –∑ –¥—Ä—É–∑—è–º–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ –±–æ–Ω—É—Å–∏!',
                referralCodeNotFound: '–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏–π –∫–æ–¥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
                linkCopied: '–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!',
                settings: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è',
                currency: '–í–∞–ª—é—Ç–∞',
                language: '–ú–æ–≤–∞',
                servers: '–î–æ—Å—Ç—É–ø–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∏',
                serversLoading: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—ñ–≤...',
                serversNotFound: '–°–µ—Ä–≤–µ—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
                activateSubscription: '–ê–∫—Ç–∏–≤—É–π—Ç–µ –ø—ñ–¥–ø–∏—Å–∫—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å–µ—Ä–≤–µ—Ä—ñ–≤',
                tariffs: '–¢–∞—Ä–∏—Ñ–∏',
                tariffsLoading: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞—Ä–∏—Ñ—ñ–≤...',
                tariffsNotFound: '–¢–∞—Ä–∏—Ñ–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
                selectTariff: '–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∞—Ä–∏—Ñ',
                selectPayment: '–í–∏–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏',
                support: '–ü—ñ–¥—Ç—Ä–∏–º–∫–∞',
                info: '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è',
                myTickets: '–ú–æ—ó —Ç—ñ–∫–µ—Ç–∏',
                noTickets: '–£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î —Ç—ñ–∫–µ—Ç—ñ–≤',
                createTicket: '–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—ñ–∫–µ—Ç',
                ticketSubject: '–¢–µ–º–∞ —Ç—ñ–∫–µ—Ç—É',
                message: '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è',
                send: '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏',
                connect: '–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è',
                error: '–ü–æ–º–∏–ª–∫–∞',
                errorLoading: '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö',
                errorLoadingServers: '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä—ñ–≤',
                errorLoadingTickets: '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç—ñ–∫–µ—Ç—ñ–≤',
                fillAllFields: '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è',
                ticketCreated: '–¢—ñ–∫–µ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!',
                errorCreatingTicket: '–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—ñ–∫–µ—Ç—É',
                currencyChanged: '–í–∞–ª—é—Ç—É –∑–º—ñ–Ω–µ–Ω–æ',
                languageChanged: '–ú–æ–≤—É –∑–º—ñ–Ω–µ–Ω–æ',
                promoActivated: '–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ',
                promoError: '–ü–æ–º–∏–ª–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ø—Ä–æ–º–æ–∫–æ–¥—É',
                promoApplied: '–ü—Ä–æ–º–æ–∫–æ–¥ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ',
                promoInvalid: '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø—Ä–æ–º–æ–∫–æ–¥',
                basic: '–ë–∞–∑–æ–≤–∏–π',
                premium: '–ü—Ä–µ–º—ñ—É–º',
                elite: '–ï–ª—ñ—Ç–Ω–∏–π',
                daysWord: '–¥–Ω—ñ–≤',
                ticket: '–¢—ñ–∫–µ—Ç',
                ticketNum: '–¢—ñ–∫–µ—Ç #',
                open: '–í—ñ–¥–∫—Ä–∏—Ç–æ',
                closed: '–ó–∞–∫—Ä–∏—Ç–æ',
                ok: 'OK',
                errorAuth: '–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó',
                errorPayment: '–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É',
                errorCopy: '–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è',
                errorPromoCheck: '–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥—É',
                promoAppliedWithDiscount: '–ü—Ä–æ–º–æ–∫–æ–¥ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ! –ó–Ω–∏–∂–∫–∞',
                promoDaysActivate: '–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ –¥–Ω—ñ –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—ñ–¥–ø–∏—Å–∫–∏',
                enterPromoCode: '–í–≤–µ–¥—ñ—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥',
                viewTicketOnSite: '–î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ —Å–∞–π—Ç',
                errorGettingToken: '–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞',
                noAuthData: '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó',
                errorLoadingSubscription: '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—ñ–¥–ø–∏—Å–∫–∏'
            },
            en: {
                loading: 'Loading...',
                subscriptionStatus: 'Subscription Status',
                active: 'Active',
                inactive: 'Inactive',
                expires: 'Expires:',
                daysLeft: 'Days Left:',
                traffic: 'Traffic:',
                unlimited: 'Unlimited',
                expired: 'Expired',
                days: 'days',
                loginData: 'Login Data',
                email: 'Email:',
                password: 'Password:',
                notAvailable: 'Not available',
                promoActivation: 'Promo Code Activation',
                enterCode: 'Enter code...',
                promoCode: 'Promo Code',
                apply: 'Apply',
                referralProgram: 'Referral Program',
                shareLink: 'Share the link with friends and get bonuses!',
                referralCodeNotFound: 'Referral code not found',
                linkCopied: 'Link copied!',
                settings: 'Settings',
                currency: 'Currency',
                language: 'Language',
                servers: 'Available Servers',
                serversLoading: 'Loading servers...',
                serversNotFound: 'Servers not found',
                activateSubscription: 'Activate subscription to view servers',
                tariffs: 'Tariffs',
                tariffsLoading: 'Loading tariffs...',
                tariffsNotFound: 'Tariffs not found',
                selectTariff: 'Select Tariff',
                selectPayment: 'Select Payment Method',
                support: 'Support',
                info: 'Information',
                myTickets: 'My Tickets',
                noTickets: 'You have no tickets yet',
                createTicket: 'Create Ticket',
                ticketSubject: 'Ticket Subject',
                message: 'Message',
                send: 'Send',
                connect: 'Connect',
                error: 'Error',
                errorLoading: 'Error loading data',
                errorLoadingServers: 'Error loading servers',
                errorLoadingTickets: 'Error loading tickets',
                fillAllFields: 'Fill all fields',
                ticketCreated: 'Ticket created successfully!',
                errorCreatingTicket: 'Error creating ticket',
                currencyChanged: 'Currency changed',
                languageChanged: 'Language changed',
                promoActivated: 'Promo code activated',
                promoError: 'Error activating promo code',
                promoApplied: 'Promo code applied',
                promoInvalid: 'Invalid promo code',
                basic: 'Basic',
                premium: 'Premium',
                elite: 'Elite',
                daysWord: 'days',
                ticket: 'Ticket',
                ticketNum: 'Ticket #',
                open: 'Open',
                closed: 'Closed',
                ok: 'OK',
                errorAuth: 'Authorization error',
                errorPayment: 'Error creating payment',
                errorCopy: 'Copy error',
                errorPromoCheck: 'Error checking promo code',
                promoAppliedWithDiscount: 'Promo code applied! Discount',
                promoDaysActivate: 'Free days promo code is activated on the subscription page',
                enterPromoCode: 'Enter promo code',
                viewTicketOnSite: 'Go to the website to view',
                errorGettingToken: 'Error getting token',
                noAuthData: 'No authorization data',
                errorLoadingSubscription: 'Error loading subscription data'
            },
            cn: {
                loading: 'Âä†ËΩΩ‰∏≠...',
                subscriptionStatus: 'ËÆ¢ÈòÖÁä∂ÊÄÅ',
                active: 'Ê¥ªË∑É',
                inactive: 'ÈùûÊ¥ªË∑É',
                expires: 'Âà∞Êúü:',
                daysLeft: 'Ââ©‰ΩôÂ§©Êï∞:',
                traffic: 'ÊµÅÈáè:',
                unlimited: 'Êó†ÈôêÂà∂',
                expired: 'Â∑≤ËøáÊúü',
                days: 'Â§©',
                loginData: 'ÁôªÂΩïÊï∞ÊçÆ',
                email: 'ÈÇÆÁÆ±:',
                password: 'ÂØÜÁ†Å:',
                notAvailable: '‰∏çÂèØÁî®',
                promoActivation: '‰øÉÈîÄ‰ª£Á†ÅÊøÄÊ¥ª',
                enterCode: 'ËæìÂÖ•‰ª£Á†Å...',
                promoCode: '‰øÉÈîÄ‰ª£Á†Å',
                apply: 'Â∫îÁî®',
                referralProgram: 'Êé®ËçêËÆ°Âàí',
                shareLink: '‰∏éÊúãÂèãÂàÜ‰∫´ÈìæÊé•Âπ∂Ëé∑ÂæóÂ•ñÂä±ÔºÅ',
                referralCodeNotFound: 'Êú™ÊâæÂà∞Êé®Ëçê‰ª£Á†Å',
                linkCopied: 'ÈìæÊé•Â∑≤Â§çÂà∂ÔºÅ',
                settings: 'ËÆæÁΩÆ',
                currency: 'Ë¥ßÂ∏Å',
                language: 'ËØ≠Ë®Ä',
                servers: 'ÂèØÁî®ÊúçÂä°Âô®',
                serversLoading: 'Âä†ËΩΩÊúçÂä°Âô®...',
                serversNotFound: 'Êú™ÊâæÂà∞ÊúçÂä°Âô®',
                activateSubscription: 'ÊøÄÊ¥ªËÆ¢ÈòÖ‰ª•Êü•ÁúãÊúçÂä°Âô®',
                tariffs: 'ËµÑË¥π',
                tariffsLoading: 'Âä†ËΩΩËµÑË¥π...',
                tariffsNotFound: 'Êú™ÊâæÂà∞ËµÑË¥π',
                selectTariff: 'ÈÄâÊã©ËµÑË¥π',
                selectPayment: 'ÈÄâÊã©‰ªòÊ¨æÊñπÂºè',
                support: 'ÊîØÊåÅ',
                info: '‰ø°ÊÅØ',
                myTickets: 'ÊàëÁöÑÂ∑•Âçï',
                noTickets: 'ÊÇ®ËøòÊ≤°ÊúâÂ∑•Âçï',
                createTicket: 'ÂàõÂª∫Â∑•Âçï',
                ticketSubject: 'Â∑•Âçï‰∏ªÈ¢ò',
                message: 'Ê∂àÊÅØ',
                send: 'ÂèëÈÄÅ',
                connect: 'ËøûÊé•',
                error: 'ÈîôËØØ',
                errorLoading: 'Âä†ËΩΩÊï∞ÊçÆÈîôËØØ',
                errorLoadingServers: 'Âä†ËΩΩÊúçÂä°Âô®ÈîôËØØ',
                errorLoadingTickets: 'Âä†ËΩΩÂ∑•ÂçïÈîôËØØ',
                fillAllFields: 'Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ',
                ticketCreated: 'Â∑•ÂçïÂàõÂª∫ÊàêÂäüÔºÅ',
                errorCreatingTicket: 'ÂàõÂª∫Â∑•ÂçïÈîôËØØ',
                currencyChanged: 'Ë¥ßÂ∏ÅÂ∑≤Êõ¥Êîπ',
                languageChanged: 'ËØ≠Ë®ÄÂ∑≤Êõ¥Êîπ',
                promoActivated: '‰øÉÈîÄ‰ª£Á†ÅÂ∑≤ÊøÄÊ¥ª',
                promoError: 'ÊøÄÊ¥ª‰øÉÈîÄ‰ª£Á†ÅÈîôËØØ',
                promoApplied: '‰øÉÈîÄ‰ª£Á†ÅÂ∑≤Â∫îÁî®',
                promoInvalid: 'Êó†ÊïàÁöÑ‰øÉÈîÄ‰ª£Á†Å',
                basic: 'Âü∫Á°Ä',
                premium: 'È´òÁ∫ß',
                elite: 'Á≤æËã±',
                daysWord: 'Â§©',
                ticket: 'Â∑•Âçï',
                ticketNum: 'Â∑•Âçï #',
                open: 'ÊâìÂºÄ',
                closed: 'ÂÖ≥Èó≠',
                ok: 'Á°ÆÂÆö',
                errorAuth: 'ÊéàÊùÉÈîôËØØ',
                errorPayment: 'ÂàõÂª∫‰ªòÊ¨æÈîôËØØ',
                errorCopy: 'Â§çÂà∂ÈîôËØØ',
                errorPromoCheck: 'Ê£ÄÊü•‰øÉÈîÄ‰ª£Á†ÅÈîôËØØ',
                promoAppliedWithDiscount: '‰øÉÈîÄ‰ª£Á†ÅÂ∑≤Â∫îÁî®ÔºÅÊäòÊâ£',
                promoDaysActivate: 'ÂÖçË¥πÂ§©Êï∞‰øÉÈîÄ‰ª£Á†ÅÂú®ËÆ¢ÈòÖÈ°µÈù¢ÊøÄÊ¥ª',
                enterPromoCode: 'ËæìÂÖ•‰øÉÈîÄ‰ª£Á†Å',
                viewTicketOnSite: 'ËΩ¨Âà∞ÁΩëÁ´ôÊü•Áúã',
                errorGettingToken: 'Ëé∑Âèñ‰ª§ÁâåÈîôËØØ',
                noAuthData: 'Êó†ÊéàÊùÉÊï∞ÊçÆ',
                errorLoadingSubscription: 'Âä†ËΩΩËÆ¢ÈòÖÊï∞ÊçÆÈîôËØØ'
            }
        };

        function t(key) {
            return translations[currentLanguage]?.[key] || translations['ru'][key] || key;
        }

        function updateLanguageUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            const loadingText = document.getElementById('loadingText');
            if (loadingText) loadingText.textContent = t('loading');
            
            const errorLoadingText = document.getElementById('errorLoadingText');
            if (errorLoadingText) errorLoadingText.textContent = t('errorLoading');
            
            const serversLoadingText = document.getElementById('serversLoadingText');
            if (serversLoadingText) serversLoadingText.textContent = t('serversLoading');
            
            const tariffsLoadingText = document.getElementById('tariffsLoadingText');
            if (tariffsLoadingText) tariffsLoadingText.textContent = t('tariffsLoading');
            
            const ticketsLoadingText = document.getElementById('ticketsLoadingText');
            if (ticketsLoadingText) ticketsLoadingText.textContent = t('errorLoadingTickets');
            
            const selectTariffTitle = document.getElementById('selectTariffTitle');
            if (selectTariffTitle) selectTariffTitle.textContent = t('selectTariff');
            
            const selectPaymentTitle = document.getElementById('selectPaymentTitle');
            if (selectPaymentTitle) selectPaymentTitle.textContent = t('selectPayment');
            
            const createTicketText = document.getElementById('createTicketText');
            if (createTicketText) createTicketText.textContent = t('createTicket');
            
            const promoOkBtn = document.getElementById('promoOkBtn');
            if (promoOkBtn) promoOkBtn.textContent = t('ok');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–ª–æ–∫–æ–≤
            const subscriptionStatusTitle = document.getElementById('subscriptionStatusTitle');
            if (subscriptionStatusTitle) subscriptionStatusTitle.textContent = t('subscriptionStatus');
            
            const loginDataTitle = document.getElementById('loginDataTitle');
            if (loginDataTitle) loginDataTitle.textContent = t('loginData');
            
            const promoActivationTitle = document.getElementById('promoActivationTitle');
            if (promoActivationTitle) promoActivationTitle.textContent = t('promoActivation');
            
            const referralProgramTitle = document.getElementById('referralProgramTitle');
            if (referralProgramTitle) referralProgramTitle.textContent = t('referralProgram');
            
            const settingsTitle = document.getElementById('settingsTitle');
            if (settingsTitle) settingsTitle.textContent = t('settings');
            
            const serversTitle = document.getElementById('serversTitle');
            if (serversTitle) serversTitle.textContent = t('servers');
            
            const promoCodeTitle = document.getElementById('promoCodeTitle');
            if (promoCodeTitle) promoCodeTitle.textContent = t('promoCode');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –ø–æ–ª–µ–π
            const expiresLabel = document.getElementById('expiresLabel');
            if (expiresLabel) expiresLabel.textContent = t('expires');
            
            const daysLeftLabel = document.getElementById('daysLeftLabel');
            if (daysLeftLabel) daysLeftLabel.textContent = t('daysLeft');
            
            const trafficLabel = document.getElementById('trafficLabel');
            if (trafficLabel) trafficLabel.textContent = t('traffic');
            
            const emailLabel = document.getElementById('emailLabel');
            if (emailLabel) emailLabel.textContent = t('email');
            
            const passwordLabel = document.getElementById('passwordLabel');
            if (passwordLabel) passwordLabel.textContent = t('password');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
            const promoCodeInputPlaceholder = document.getElementById('promoCodeInputPlaceholder');
            if (promoCodeInputPlaceholder) promoCodeInputPlaceholder.placeholder = t('enterCode');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
            const shareLinkText = document.getElementById('shareLinkText');
            if (shareLinkText) shareLinkText.textContent = t('shareLink');

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            const navInfo = document.getElementById('navInfo')?.querySelector('.nav-item-label');
            if (navInfo) navInfo.textContent = t('info');
            
            const navServers = document.getElementById('navServers')?.querySelector('.nav-item-label');
            if (navServers) navServers.textContent = t('servers');
            
            const navTariffs = document.getElementById('navTariffs')?.querySelector('.nav-item-label');
            if (navTariffs) navTariffs.textContent = t('tariffs');
            
            const navSupport = document.getElementById('navSupport')?.querySelector('.nav-item-label');
            if (navSupport) navSupport.textContent = t('support');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            const connectBtn = document.getElementById('floatingConnectBtn');
            if (connectBtn) {
                connectBtn.textContent = `üöÄ ${t('connect')}`;
            }
            
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞—Ä–∏—Ñ—ã –∏ —Å–µ—Ä–≤–µ—Ä—ã, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—ã
            if (tariffs && tariffs.length > 0) {
                renderTariffs();
            }
            if (servers && servers.length > 0) {
                renderServers();
            }
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º—ã
        if (tg.colorScheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–µ–Ω–¥–∏–Ω–≥–∞
        async function loadBranding() {
            try {
                const response = await fetch('/api/public/branding');
                if (response.ok) {
                    branding = await response.json();
                    applyBranding();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–µ–Ω–¥–∏–Ω–≥–∞:', error);
            }
        }

        function applyBranding() {
            const brandingHeader = document.getElementById('brandingHeader');
            const brandingLogo = document.getElementById('brandingLogo');
            const brandingTitle = document.getElementById('brandingTitle');
            const brandingSubtitle = document.getElementById('brandingSubtitle');

            if (branding.site_name) {
                brandingTitle.textContent = branding.site_name;
            }
            if (branding.site_subtitle) {
                brandingSubtitle.textContent = branding.site_subtitle;
            }
            if (branding.logo_url) {
                brandingLogo.src = branding.logo_url;
                brandingLogo.style.display = 'block';
            }

            if (branding.site_name || branding.site_subtitle || branding.logo_url) {
                brandingHeader.classList.remove('hidden');
            }
        }

        function toggleServers() {
            serversExpanded = !serversExpanded;
            const serversSection = document.getElementById('serversSection');
            const serversToggle = document.getElementById('serversToggle');
            
            if (serversExpanded) {
                serversSection.classList.remove('collapsed');
                serversSection.classList.add('expanded');
                serversToggle.textContent = '‚ñ≤';
                serversToggle.classList.add('expanded');
            } else {
                serversSection.classList.remove('expanded');
                serversSection.classList.add('collapsed');
                serversToggle.textContent = '‚ñº';
                serversToggle.classList.remove('expanded');
            }
        }

        function getSubscriptionUrl() {
            if (userData && userData.subscriptionUrl) {
                return userData.subscriptionUrl;
            }
            // –ï—Å–ª–∏ –Ω–µ—Ç subscriptionUrl, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–Ω–µ–ª—å
            return 'https://panel.stealthnet.app/dashboard/subscription';
        }

        function switchPage(page) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const pageElement = document.getElementById(`page${page.charAt(0).toUpperCase() + page.slice(1)}`);
            const navElement = document.getElementById(`nav${page.charAt(0).toUpperCase() + page.slice(1)}`);

            if (pageElement) {
                pageElement.classList.add('active');
            }
            if (navElement) {
                navElement.classList.add('active');
            }

            currentPage = page;

            // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ—Ä–≤–µ—Ä–æ–≤, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Ö –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
            if (page === 'servers' && servers.length === 0) {
                loadServers();
            }

            // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–∏–∫–µ—Ç—ã
            if (page === 'support') {
                loadTickets();
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"
            updateFloatingButton();
        }

        function handleConnectClick(event) {
            event.preventDefault();
            event.stopPropagation();
            const url = getSubscriptionUrl();
            if (url) {
                tg.openLink(url);
            }
        }

        function updateFloatingButton() {
            const floatingBtn = document.getElementById('floatingConnectBtn');
            if (!floatingBtn) return;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
            const isOnInfoPage = currentPage === 'info';
            const isActive = userData && userData.activeInternalSquads && userData.activeInternalSquads.length > 0;
            
            if (isOnInfoPage && isActive && userData.subscriptionUrl) {
                floatingBtn.classList.remove('hidden');
            } else {
                floatingBtn.classList.add('hidden');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                const initData = tg.initData || '';
                if (!initData) {
                    throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–µ–Ω–¥–∏–Ω–≥
                await loadBranding();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
                const subscriptionResponse = await fetch('/miniapp/subscription', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData })
                });

                if (!subscriptionResponse.ok) {
                    throw new Error(t('errorLoadingSubscription'));
                }

                const subscriptionData = await subscriptionResponse.json();
                userData = subscriptionData.response || subscriptionData;
                
                console.log('Loaded userData:', userData);
                console.log('referral_code in userData:', userData?.referral_code);
                console.log('Full userData keys:', Object.keys(userData || {}));
                
                // –ï—Å–ª–∏ referral_code –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ /api/client/me
                if (!userData?.referral_code && !userData?.referralCode) {
                    console.log('referral_code not found, trying to fetch from /api/client/me...');
                    try {
                        const initData = tg.initData || '';
                        const telegramId = getUserFromInitData(initData);
                        
                        if (telegramId) {
                            const tokenResponse = await fetch('/api/bot/get-token', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ telegram_id: telegramId })
                            });
                            
                            if (tokenResponse.ok) {
                                const tokenData = await tokenResponse.json();
                                const token = tokenData.token;
                                
                                const userResponse = await fetch('/api/client/me', {
                                    headers: { 'Authorization': `Bearer ${token}` }
                                });
                                
                                if (userResponse.ok) {
                                    const userApiData = await userResponse.json();
                                    console.log('Got user data from /api/client/me:', userApiData);
                                    console.log('Full userApiData keys:', Object.keys(userApiData || {}));
                                    
                                    // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {"response": {...}}, –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                                    const responseData = userApiData.response || userApiData;
                                    console.log('responseData:', responseData);
                                    console.log('responseData.referral_code:', responseData?.referral_code);
                                    
                                    const referralCode = responseData?.referral_code || responseData?.referralCode || userApiData?.referral_code || userApiData?.referralCode;
                                    console.log('Final referralCode from /api/client/me:', referralCode);
                                    
                                    if (referralCode) {
                                        userData.referral_code = referralCode;
                                        console.log('Set referral_code from /api/client/me:', referralCode);
                                    } else {
                                        console.log('referral_code is null/undefined - user may not have referral_code in database');
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error fetching referral_code from /api/client/me:', error);
                    }
                }
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (userData?.preferred_lang) {
                    currentLanguage = userData.preferred_lang;
                    document.documentElement.lang = currentLanguage;
                }
                
                updateSubscriptionInfo();
                updateFloatingButton();
                updateLanguageUI();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã serverDomain —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
                setTimeout(() => {
                    updateReferralLink();
                }, 1000);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞—Ä–∏—Ñ—ã
                const tariffsResponse = await fetch('/miniapp/tariffs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData })
                });

                if (tariffsResponse.ok) {
                    const tariffsData = await tariffsResponse.json();
                    tariffs = tariffsData.tariffs || tariffsData.response || [];
                    renderTariffs();
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ä–≤–µ—Ä–æ–≤
                if (currentPage === 'servers') {
                    await loadServers();
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
                const paymentMethodsResponse = await fetch('/miniapp/payments/methods', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData })
                });

                if (paymentMethodsResponse.ok) {
                    const paymentData = await paymentMethodsResponse.json();
                    paymentMethods = paymentData.methods || [];
                }

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
                const loadingText = document.getElementById('loadingText');
                if (loadingText) {
                    loadingText.textContent = t('loading');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
            }
        }

        async function loadServers() {
            try {
                const initData = tg.initData || '';
                
                if (!userData || !userData.activeInternalSquads || userData.activeInternalSquads.length === 0) {
                    document.getElementById('serversList').innerHTML = `<div class="error">${t('activateSubscription')}</div>`;
                    return;
                }

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ—Ä–≤–µ—Ä—ã —á–µ—Ä–µ–∑ miniapp —ç–Ω–¥–ø–æ–∏–Ω—Ç
                const response = await fetch('/miniapp/nodes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData })
                });

                if (response.ok) {
                    const data = await response.json();
                    servers = data.response?.activeNodes || data.activeNodes || [];
                    renderServers();
                } else {
                    document.getElementById('serversList').innerHTML = `<div class="error">${t('errorLoadingServers')}</div>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤:', error);
                document.getElementById('serversList').innerHTML = `<div class="error">${t('errorLoadingServers')}</div>`;
            }
        }

        function updateSubscriptionInfo() {
            if (!userData) return;

            const isActive = userData.activeInternalSquads && userData.activeInternalSquads.length > 0;
            const statusBadge = document.getElementById('subscriptionStatus');
            const expireDateEl = document.getElementById('expireDate');
            const daysLeftEl = document.getElementById('daysLeft');
            const trafficEl = document.getElementById('traffic');
            const trafficProgress = document.getElementById('trafficProgress');
            const trafficProgressFill = document.getElementById('trafficProgressFill');
            const userEmailEl = document.getElementById('userEmail');
            const userPasswordEl = document.getElementById('userPassword');

            if (isActive) {
                statusBadge.textContent = t('active');
                statusBadge.className = 'status-badge status-active';

                if (userData.expireAt) {
                    const expireDate = new Date(userData.expireAt);
                    expireDateEl.textContent = expireDate.toLocaleDateString(currentLanguage === 'ru' ? 'ru-RU' : currentLanguage === 'ua' ? 'uk-UA' : currentLanguage === 'en' ? 'en-US' : 'zh-CN');
                    
                    const now = new Date();
                    const daysLeft = Math.ceil((expireDate - now) / (1000 * 60 * 60 * 24));
                    daysLeftEl.textContent = daysLeft > 0 ? `${daysLeft} ${t('days')}` : t('expired');
                }

                const usedTraffic = userData.usedTrafficBytes || 0;
                const limitTraffic = userData.trafficLimitBytes || 0;

                if (limitTraffic === 0) {
                    trafficEl.textContent = t('unlimited');
                    trafficProgress.classList.add('hidden');
                } else {
                    const usedGB = (usedTraffic / (1024 ** 3)).toFixed(2);
                    const limitGB = (limitTraffic / (1024 ** 3)).toFixed(2);
                    const percentage = (usedTraffic / limitTraffic * 100).toFixed(0);
                    trafficEl.textContent = `${usedGB} / ${limitGB} GB`;
                    trafficProgress.classList.remove('hidden');
                    trafficProgressFill.style.width = `${Math.min(percentage, 100)}%`;
                }
            } else {
                statusBadge.textContent = t('inactive');
                statusBadge.className = 'status-badge status-inactive';
                expireDateEl.textContent = '-';
                daysLeftEl.textContent = '-';
                trafficEl.textContent = '-';
                trafficProgress.classList.add('hidden');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º email –∏ –ø–∞—Ä–æ–ª—å
            if (userEmailEl) {
                userEmailEl.textContent = userData.email || '-';
            }
            if (userPasswordEl) {
                // –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ userData, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ —á–µ—Ä–µ–∑ API
                if (!userData.password) {
                    loadUserPassword();
                } else {
                    userPasswordEl.textContent = userData.password;
                }
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
            updateReferralLink();

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª—é—Ç—ã –∏ —è–∑—ã–∫–∞
            updateSettingsUI();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            if (userData?.preferred_lang) {
                currentLanguage = userData.preferred_lang;
                document.documentElement.lang = currentLanguage;
                updateLanguageUI();
            }
        }

        function updateSettingsUI() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –≤–∞–ª—é—Ç—É
            if (userData?.preferred_currency) {
                currentCurrency = userData.preferred_currency;
            }
            const currencySelect = document.getElementById('currencySelect');
            if (currencySelect) {
                currencySelect.value = currentCurrency;
            }

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫
            if (userData?.preferred_lang) {
                currentLanguage = userData.preferred_lang;
            }
            const languageSelect = document.getElementById('languageSelect');
            if (languageSelect) {
                languageSelect.value = currentLanguage;
            }
        }

        function getServerStatus(server) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
            if (server.isNodeOnline !== undefined && server.isNodeOnline !== null) {
                return server.isNodeOnline;
            }
            if (server.isOnline !== undefined && server.isOnline !== null) {
                return server.isOnline;
            }
            if (server.isActive !== undefined && server.isActive !== null) {
                return server.isActive;
            }
            if (server.enabled !== undefined && server.enabled !== null) {
                return server.enabled;
            }
            if (server.status) {
                const status = String(server.status).toLowerCase().trim();
                return status === 'online' || status === 'active' || status === 'running' || status === 'healthy' || status === 'enabled';
            }
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—á–∏—Ç–∞–µ–º —Å–µ—Ä–≤–µ—Ä –æ–Ω–ª–∞–π–Ω, –µ—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞ offline
            return true;
        }

        function renderServers() {
            const serversList = document.getElementById('serversList');
            
            if (servers.length === 0) {
                serversList.innerHTML = `<div class="error">${t('serversNotFound')}</div>`;
                return;
            }

            serversList.innerHTML = servers.map(server => {
                const isOnline = getServerStatus(server);
                return `
                    <div class="server-item">
                        <div>
                            <div class="server-name">${server.nodeName || 'Unknown'}</div>
                            <div class="server-region">${server.regionName || server.countryCode || 'Unknown'}</div>
                        </div>
                        <div class="server-status ${isOnline ? '' : 'offline'}"></div>
                    </div>
                `;
            }).join('');
        }

        function getTariffTier(tariff) {
            // –ï—Å–ª–∏ tier —É–∫–∞–∑–∞–Ω –≤ —Ç–∞—Ä–∏—Ñ–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
            if (tariff.tier && ['basic', 'pro', 'elite'].includes(tariff.tier)) {
                return tariff.tier;
            }
            // –ò–Ω–∞—á–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const duration = tariff.duration_days || 0;
            if (duration >= 180) return 'elite';
            if (duration >= 90) return 'pro';
            return 'basic';
        }

        function renderTariffs() {
            const tariffsList = document.getElementById('tariffsList');
            
            if (tariffs.length === 0) {
                tariffsList.innerHTML = `<div class="error">${t('tariffsNotFound')}</div>`;
                return;
            }

            // –ü–æ–ª—É—á–∞–µ–º –≤–∞–ª—é—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∞–ª—é—Ç—É)
            const currency = currentCurrency || userData?.preferred_currency || 'uah';
            const currencyMap = {
                'uah': { field: 'price_uah', symbol: '‚Ç¥' },
                'rub': { field: 'price_rub', symbol: '‚ÇΩ' },
                'usd': { field: 'price_usd', symbol: '$' }
            };
            const currencyConfig = currencyMap[currency] || currencyMap['uah'];

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ—ã –ø–æ tier
            const basicTariffs = [];
            const proTariffs = [];
            const eliteTariffs = [];

            tariffs.forEach(tariff => {
                const tier = getTariffTier(tariff);
                if (tier === 'elite') {
                    eliteTariffs.push(tariff);
                } else if (tier === 'pro') {
                    proTariffs.push(tariff);
                } else {
                    basicTariffs.push(tariff);
                }
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ—ã –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            basicTariffs.sort((a, b) => (a.duration_days || 0) - (b.duration_days || 0));
            proTariffs.sort((a, b) => (a.duration_days || 0) - (b.duration_days || 0));
            eliteTariffs.sort((a, b) => (a.duration_days || 0) - (b.duration_days || 0));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞—Ä–∏—Ñ—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –¥–µ–ª–∞–µ–º –∏—Ö –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏
            let html = '';
            
            if (basicTariffs.length > 0) {
                html += `<div style="margin-bottom: 20px;"><div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">üì¶ ${t('basic')}</div>`;
                html += basicTariffs.map(tariff => {
                    const price = tariff[currencyConfig.field] || 0;
                    const tariffId = tariff.id || tariff.tariff_id;
                    if (!tariffId) {
                        console.error('Tariff –±–µ–∑ ID:', tariff);
                        return '';
                    }
                    return `
                        <div class="tariff-card" onclick="selectTariff(${tariffId})" style="margin-bottom: 8px; cursor: pointer;">
                            <div class="tariff-info">
                                <div class="tariff-name">${tariff.name || `${tariff.duration_days} ${t('daysWord')}`}</div>
                                <div class="tariff-duration">${tariff.duration_days} ${t('daysWord')}</div>
                            </div>
                            <div class="tariff-price">${price} ${currencyConfig.symbol}</div>
                        </div>
                    `;
                }).join('');
                html += '</div>';
            }

            if (proTariffs.length > 0) {
                html += `<div style="margin-bottom: 20px;"><div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">‚≠ê ${t('premium')}</div>`;
                html += proTariffs.map(tariff => {
                    const price = tariff[currencyConfig.field] || 0;
                    const tariffId = tariff.id || tariff.tariff_id;
                    if (!tariffId) {
                        console.error('Tariff –±–µ–∑ ID:', tariff);
                        return '';
                    }
                    return `
                        <div class="tariff-card" onclick="selectTariff(${tariffId})" style="margin-bottom: 8px; cursor: pointer;">
                            <div class="tariff-info">
                                <div class="tariff-name">${tariff.name || `${tariff.duration_days} ${t('daysWord')}`}</div>
                                <div class="tariff-duration">${tariff.duration_days} ${t('daysWord')}</div>
                            </div>
                            <div class="tariff-price">${price} ${currencyConfig.symbol}</div>
                        </div>
                    `;
                }).join('');
                html += '</div>';
            }

            if (eliteTariffs.length > 0) {
                html += `<div style="margin-bottom: 20px;"><div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 600;">üëë ${t('elite')}</div>`;
                html += eliteTariffs.map(tariff => {
                    const price = tariff[currencyConfig.field] || 0;
                    const tariffId = tariff.id || tariff.tariff_id;
                    if (!tariffId) {
                        console.error('Tariff –±–µ–∑ ID:', tariff);
                        return '';
                    }
                    return `
                        <div class="tariff-card" onclick="selectTariff(${tariffId})" style="margin-bottom: 8px; cursor: pointer;">
                            <div class="tariff-info">
                                <div class="tariff-name">${tariff.name || `${tariff.duration_days} ${t('daysWord')}`}</div>
                                <div class="tariff-duration">${tariff.duration_days} ${t('daysWord')}</div>
                            </div>
                            <div class="tariff-price">${price} ${currencyConfig.symbol}</div>
                        </div>
                    `;
                }).join('');
                html += '</div>';
            }

            tariffsList.innerHTML = html || `<div class="error">${t('tariffsNotFound')}</div>`;
        }

        function openTariffsModal() {
            const modal = document.getElementById('tariffsModal');
            const tariffsModalList = document.getElementById('tariffsModalList');
            
            // –ü–æ–ª—É—á–∞–µ–º –≤–∞–ª—é—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∞–ª—é—Ç—É)
            const currency = currentCurrency || userData?.preferred_currency || 'uah';
            const currencyMap = {
                'uah': { field: 'price_uah', symbol: '‚Ç¥' },
                'rub': { field: 'price_rub', symbol: '‚ÇΩ' },
                'usd': { field: 'price_usd', symbol: '$' }
            };
            const currencyConfig = currencyMap[currency] || currencyMap['uah'];

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ—ã –ø–æ tier
            const basicTariffs = [];
            const proTariffs = [];
            const eliteTariffs = [];

            tariffs.forEach(tariff => {
                const tier = getTariffTier(tariff);
                if (tier === 'elite') {
                    eliteTariffs.push(tariff);
                } else if (tier === 'pro') {
                    proTariffs.push(tariff);
                } else {
                    basicTariffs.push(tariff);
                }
            });

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ—ã –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            basicTariffs.sort((a, b) => (a.duration_days || 0) - (b.duration_days || 0));
            proTariffs.sort((a, b) => (a.duration_days || 0) - (b.duration_days || 0));
            eliteTariffs.sort((a, b) => (a.duration_days || 0) - (b.duration_days || 0));

            let html = '';

            if (basicTariffs.length > 0) {
                html += `<div style="margin-bottom: 24px;"><div style="font-size: 16px; color: var(--text-primary); margin-bottom: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px;"><span>üì¶</span> ${t('basic')}</div>`;
                html += basicTariffs.map(tariff => {
                    const price = tariff[currencyConfig.field] || 0;
                    const tariffId = tariff.id || tariff.tariff_id;
                    const isSelected = selectedTariffId === tariffId;
                    if (!tariffId) {
                        console.error('Tariff –±–µ–∑ ID:', tariff);
                        return '';
                    }
                    return `
                        <div class="tariff-card ${isSelected ? 'selected' : ''}" onclick="selectTariff(${tariffId})" style="margin-bottom: 8px; cursor: pointer;">
                            <div class="tariff-info">
                                <div class="tariff-name">${tariff.name || `${tariff.duration_days} ${t('daysWord')}`}</div>
                                <div class="tariff-duration">${tariff.duration_days} ${t('daysWord')}</div>
                            </div>
                            <div class="tariff-price">${price} ${currencyConfig.symbol}</div>
                        </div>
                    `;
                }).join('');
                html += '</div>';
            }

            if (proTariffs.length > 0) {
                html += `<div style="margin-bottom: 24px;"><div style="font-size: 16px; color: var(--text-primary); margin-bottom: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px;"><span>‚≠ê</span> ${t('premium')}</div>`;
                html += proTariffs.map(tariff => {
                    const price = tariff[currencyConfig.field] || 0;
                    const tariffId = tariff.id || tariff.tariff_id;
                    const isSelected = selectedTariffId === tariffId;
                    if (!tariffId) {
                        console.error('Tariff –±–µ–∑ ID:', tariff);
                        return '';
                    }
                    return `
                        <div class="tariff-card ${isSelected ? 'selected' : ''}" onclick="selectTariff(${tariffId})" style="margin-bottom: 8px; cursor: pointer;">
                            <div class="tariff-info">
                                <div class="tariff-name">${tariff.name || `${tariff.duration_days} ${t('daysWord')}`}</div>
                                <div class="tariff-duration">${tariff.duration_days} ${t('daysWord')}</div>
                            </div>
                            <div class="tariff-price">${price} ${currencyConfig.symbol}</div>
                        </div>
                    `;
                }).join('');
                html += '</div>';
            }

            if (eliteTariffs.length > 0) {
                html += `<div style="margin-bottom: 24px;"><div style="font-size: 16px; color: var(--text-primary); margin-bottom: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px;"><span>üëë</span> ${t('elite')}</div>`;
                html += eliteTariffs.map(tariff => {
                    const price = tariff[currencyConfig.field] || 0;
                    const tariffId = tariff.id || tariff.tariff_id;
                    const isSelected = selectedTariffId === tariffId;
                    if (!tariffId) {
                        console.error('Tariff –±–µ–∑ ID:', tariff);
                        return '';
                    }
                    return `
                        <div class="tariff-card ${isSelected ? 'selected' : ''}" onclick="selectTariff(${tariffId})" style="margin-bottom: 8px; cursor: pointer;">
                            <div class="tariff-info">
                                <div class="tariff-name">${tariff.name || `${tariff.duration_days} ${t('daysWord')}`}</div>
                                <div class="tariff-duration">${tariff.duration_days} ${t('daysWord')}</div>
                            </div>
                            <div class="tariff-price">${price} ${currencyConfig.symbol}</div>
                        </div>
                    `;
                }).join('');
                html += '</div>';
            }

            tariffsModalList.innerHTML = html || `<div class="error">${t('tariffsNotFound')}</div>`;
            modal.classList.add('active');
        }

        function closeTariffsModal() {
            document.getElementById('tariffsModal').classList.remove('active');
        }

        function selectTariff(tariffId) {
            console.log('–í—ã–±—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ:', tariffId);
            if (!tariffId) {
                console.error('Tariff ID –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω');
                return;
            }
            selectedTariffId = tariffId;
            // –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
            openPaymentModal();
        }

        function openPaymentModal() {
            if (!selectedTariffId) return;

            const modal = document.getElementById('paymentModal');
            const paymentMethodsList = document.getElementById('paymentMethodsList');

            const paymentNames = {
                'crystalpay': 'üí≥ CrystalPay',
                'heleket': '‚Çø Heleket',
                'yookassa': 'üí≥ YooKassa',
                'platega': 'üí≥ Platega',
                'mulenpay': 'üí≥ Mulenpay',
                'urlpay': 'üí≥ UrlPay',
                'telegram_stars': '‚≠ê Telegram Stars',
                'monobank': 'üí≥ Monobank'
            };

            paymentMethodsList.innerHTML = paymentMethods.map(method => {
                const methodName = paymentNames[method.id] || method.name || method.id;
                return `
                    <div class="payment-method" onclick="createPayment('${method.id}')">
                        ${methodName}
                    </div>
                `;
            }).join('');

            modal.classList.add('active');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }

        async function createPayment(paymentMethod) {
            if (!selectedTariffId) return;

            try {
                const initData = tg.initData || '';
                const payload = {
                    initData,
                    tariff_id: selectedTariffId,
                    payment_provider: paymentMethod
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–º–æ–∫–æ–¥, –µ—Å–ª–∏ –æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω
                if (appliedPromo && appliedPromo.type === 'PERCENT') {
                    payload.promo_code = appliedPromo.code;
                }
                
                const response = await fetch('/miniapp/payments/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                
                if (data.payment_url) {
                    tg.openLink(data.payment_url);
                } else if (data.url) {
                    tg.openLink(data.url);
                } else {
                    tg.showAlert(t('errorPayment'));
                }

                closePaymentModal();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞:', error);
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        document.getElementById('tariffsModal').addEventListener('click', (e) => {
            if (e.target.id === 'tariffsModal') {
                closeTariffsModal();
            }
        });

        document.getElementById('paymentModal').addEventListener('click', (e) => {
            if (e.target.id === 'paymentModal') {
                closePaymentModal();
            }
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
        async function activatePromoCode() {
            const input = document.getElementById('promoCodeInput');
            const btn = document.getElementById('promoActivateBtn');
            const status = document.getElementById('promoStatus');
            const code = input.value.trim().toUpperCase();
            
            if (!code) {
                status.innerHTML = '<span style="color: var(--danger);">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥</span>';
                return;
            }
            
            btn.disabled = true;
            btn.textContent = '...';
            status.innerHTML = '';
            
            try {
                const initData = tg.initData || '';
                const response = await fetch('/miniapp/promo-codes/activate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData, promo_code: code })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    status.innerHTML = `<span style="color: var(--success);">${data.message}</span>`;
                    input.value = '';
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
                    setTimeout(() => {
                        loadData();
                    }, 1500);
                } else {
                    const errorMsg = data.detail?.message || data.message || t('promoError');
                    status.innerHTML = `<span style="color: var(--danger);">${errorMsg}</span>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞:', error);
                status.innerHTML = `<span style="color: var(--danger);">${t('promoError')}</span>`;
            } finally {
                btn.disabled = false;
                btn.textContent = t('ok');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∏
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–æ–ª—è
        async function loadUserPassword() {
            try {
                const initData = tg.initData || '';
                const telegramId = getUserFromInitData(initData);
                
                if (!telegramId) {
                    console.log('Cannot load password: telegram_id not found');
                    const userPasswordEl = document.getElementById('userPassword');
                    if (userPasswordEl) {
                        userPasswordEl.textContent = t('notAvailable');
                    }
                    return;
                }
                
                const response = await fetch('/api/bot/get-credentials', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: telegramId })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Got credentials from /api/bot/get-credentials:', data);
                    
                    const password = data.password || null;
                    const userPasswordEl = document.getElementById('userPassword');
                    
                    if (userPasswordEl) {
                        if (password) {
                            userPasswordEl.textContent = password;
                            // –û–±–Ω–æ–≤–ª—è–µ–º userData
                            if (userData) {
                                userData.password = password;
                            }
                        } else {
                            userPasswordEl.textContent = t('notAvailable');
                        }
                    }
                } else {
                    console.error('Failed to fetch credentials:', response.status);
                    const userPasswordEl = document.getElementById('userPassword');
                    if (userPasswordEl) {
                        userPasswordEl.textContent = t('notAvailable');
                    }
                }
            } catch (error) {
                console.error('Error loading password:', error);
                const userPasswordEl = document.getElementById('userPassword');
                if (userPasswordEl) {
                    userPasswordEl.textContent = t('notAvailable');
                }
            }
        }

        async function loadServerDomain() {
            try {
                const response = await fetch('/api/public/server-domain');
                if (response.ok) {
                    const data = await response.json();
                    serverDomain = data.full_url || data.domain || 'panel.stealthnet.app';
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–µ–Ω–∞
                    if (userData) {
                        updateReferralLink();
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–µ–Ω–∞:', error);
            }
        }

        async function updateReferralLink() {
            console.log('updateReferralLink called, userData:', userData);
            console.log('referral_code:', userData?.referral_code);
            console.log('serverDomain:', serverDomain);
            
            if (!userData) {
                console.log('userData is null');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª—è
            let referralCode = userData.referral_code || userData.referralCode || null;
            
            // –ï—Å–ª–∏ referral_code –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ userData, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ API
            if (!referralCode) {
                console.log('referral_code not found in userData, trying to fetch from API...');
                try {
                    const initData = tg.initData || '';
                    const telegramId = getUserFromInitData(initData);
                    
                    if (telegramId) {
                        const tokenResponse = await fetch('/api/bot/get-token', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ telegram_id: telegramId })
                        });
                        
                        if (tokenResponse.ok) {
                            const tokenData = await tokenResponse.json();
                            const token = tokenData.token;
                            
                            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
                            const userResponse = await fetch('/api/client/me', {
                                headers: { 'Authorization': `Bearer ${token}` }
                            });
                            
                            if (userResponse.ok) {
                                const userApiData = await userResponse.json();
                                console.log('Got user data from /api/client/me in updateReferralLink:', userApiData);
                                console.log('Full userApiData keys:', Object.keys(userApiData || {}));
                                
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º response –æ–±–µ—Ä—Ç–∫—É
                                const responseData = userApiData.response || userApiData;
                                console.log('responseData.referral_code:', responseData?.referral_code);
                                
                                referralCode = responseData.referral_code || responseData.referralCode || userApiData.referral_code || userApiData.referralCode || null;
                                console.log('Got referral_code from API:', referralCode);
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º userData
                                if (referralCode && userData) {
                                    userData.referral_code = referralCode;
                                    console.log('Updated userData.referral_code:', userData.referral_code);
                                } else {
                                    console.log('referral_code is null or empty, cannot update userData');
                                }
                            } else {
                                console.error('Failed to fetch /api/client/me in updateReferralLink:', userResponse.status);
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error fetching referral_code from API:', error);
                }
            }
            
            const input = document.getElementById('referralLinkInput');
            
            if (!referralCode) {
                console.log('referral_code still not found after all attempts');
                console.log('This means the user does not have a referral_code in the database');
                console.log('The referral_code should be generated automatically when user is created');
                if (input) {
                    input.value = t('referralCodeNotFound');
                    input.style.color = 'var(--text-secondary)';
                    input.style.fontStyle = 'italic';
                }
                return;
            }
            
            // –ï—Å–ª–∏ referral_code –Ω–∞–π–¥–µ–Ω, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Å—ã–ª–∫—É
            if (input) {
                input.style.color = '';
                input.style.fontStyle = '';
                
                const baseUrl = serverDomain.startsWith('http') ? serverDomain : `https://${serverDomain}`;
                const referralLink = `${baseUrl}/register?ref=${referralCode}`;
                
                console.log('Generated referral link:', referralLink);
                input.value = referralLink;
                console.log('Referral link set to input');
            } else {
                console.log('referralLinkInput element not found');
            }
        }

        async function copyReferralLink() {
            const input = document.getElementById('referralLinkInput');
            const btn = document.getElementById('referralCopyBtn');
            
            if (!input || !input.value) return;
            
            try {
                await navigator.clipboard.writeText(input.value);
                const originalText = btn.textContent;
                btn.textContent = '‚úì';
                tg.showAlert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                tg.showAlert(t('errorCopy'));
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ –≤ —Ç–∞—Ä–∏—Ñ–∞—Ö
        async function checkTariffPromoCode() {
            const input = document.getElementById('tariffPromoCodeInput');
            const btn = document.getElementById('tariffPromoCheckBtn');
            const status = document.getElementById('tariffPromoStatus');
            const code = input.value.trim().toUpperCase();
            
            if (!code) {
                status.innerHTML = '<span style="color: var(--danger);">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥</span>';
                return;
            }
            
            btn.disabled = true;
            btn.textContent = '...';
            status.innerHTML = '';
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ bot/get-token
                const initData = tg.initData || '';
                const telegramId = getUserFromInitData(initData);
                
                if (!telegramId) {
                    status.innerHTML = `<span style="color: var(--danger);">${t('errorAuth')}</span>`;
                    return;
                }
                
                const tokenResponse = await fetch('/api/bot/get-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: telegramId })
                });
                
                if (!tokenResponse.ok) {
                    throw new Error(t('errorGettingToken'));
                }
                
                const tokenData = await tokenResponse.json();
                const token = tokenData.token;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
                const checkResponse = await fetch('/api/client/check-promocode', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code })
                });
                
                const checkData = await checkResponse.json();
                
                if (checkResponse.ok) {
                    if (checkData.promo_type === 'PERCENT') {
                        appliedPromo = {
                            code: checkData.code,
                            type: 'PERCENT',
                            value: checkData.value
                        };
                        status.innerHTML = `<span style="color: var(--success);">‚úì ${t('promoAppliedWithDiscount')} ${checkData.code} ${checkData.value}%</span>`;
                    } else {
                        status.innerHTML = `<span style="color: var(--warning);">${t('promoDaysActivate')}</span>`;
                        appliedPromo = null;
                    }
                } else {
                    const errorMsg = checkData.message || t('promoInvalid');
                    status.innerHTML = `<span style="color: var(--danger);">${errorMsg}</span>`;
                    appliedPromo = null;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞:', error);
                status.innerHTML = `<span style="color: var(--danger);">${t('errorPromoCheck')}</span>`;
                appliedPromo = null;
            } finally {
                btn.disabled = false;
                btn.textContent = t('apply');
            }
        }

        function getUserFromInitData(initData) {
            try {
                if (!initData) return null;
                const parsed = new URLSearchParams(initData);
                const userStr = parsed.get('user');
                if (!userStr) return null;
                const user = JSON.parse(decodeURIComponent(userStr));
                return user.id || null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ initData:', error);
                return null;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–∏–∫–µ—Ç–æ–≤
        async function loadTickets() {
            try {
                const initData = tg.initData || '';
                const telegramId = getUserFromInitData(initData);
                
                if (!telegramId) {
                    document.getElementById('ticketsList').innerHTML = `<div class="error">${t('errorAuth')}</div>`;
                    return;
                }
                
                const tokenResponse = await fetch('/api/bot/get-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: telegramId })
                });
                
                if (!tokenResponse.ok) {
                    throw new Error(t('errorGettingToken'));
                }
                
                const tokenData = await tokenResponse.json();
                const token = tokenData.token;
                
                const response = await fetch('/api/client/support-tickets', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    tickets = await response.json();
                    renderTickets();
                } else {
                    document.getElementById('ticketsList').innerHTML = `<div class="error">${t('errorLoadingTickets')}</div>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤:', error);
                document.getElementById('ticketsList').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤</div>';
            }
        }

        function renderTickets() {
            const ticketsList = document.getElementById('ticketsList');
            
            if (tickets.length === 0) {
                ticketsList.innerHTML = `<div style="padding: 20px; text-align: center; color: var(--text-secondary);">${t('noTickets')}</div>`;
                return;
            }
            
            ticketsList.innerHTML = tickets.map(ticket => {
                const statusClass = ticket.status === 'CLOSED' ? 'status-inactive' : 'status-active';
                const statusText = ticket.status === 'CLOSED' ? t('closed') : t('open');
                const date = new Date(ticket.created_at).toLocaleDateString('ru-RU');
                return `
                    <div class="card" style="margin-bottom: 12px; cursor: pointer;" onclick="openTicket(${ticket.id})">
                        <div style="padding: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-weight: 600;">${t('ticketNum')}${ticket.id}</span>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div style="color: var(--text-primary); margin-bottom: 4px;">${ticket.subject || '–ë–µ–∑ —Ç–µ–º—ã'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${date}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function openTicket(ticketId) {
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–∏–∫–µ—Ç –≤ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª–µ—Ä—Ç
            tg.showAlert(`${t('ticketNum')}${ticketId}\n${t('viewTicketOnSite')}`);
        }

        async function createTicket() {
            const subjectInput = document.getElementById('ticketSubject');
            const messageInput = document.getElementById('ticketMessage');
            const subject = subjectInput.value.trim();
            const message = messageInput.value.trim();
            
            if (!subject || !message) {
                tg.showAlert(t('fillAllFields'));
                return;
            }
            
            try {
                const initData = tg.initData || '';
                const telegramId = getUserFromInitData(initData);
                
                if (!telegramId) {
                    tg.showAlert(t('errorAuth'));
                    return;
                }
                
                const tokenResponse = await fetch('/api/bot/get-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: telegramId })
                });
                
                if (!tokenResponse.ok) {
                    throw new Error(t('errorGettingToken'));
                }
                
                const tokenData = await tokenResponse.json();
                const token = tokenData.token;
                
                const response = await fetch('/api/client/support-tickets', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ subject, message })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    tg.showAlert(t('ticketCreated'));
                    subjectInput.value = '';
                    messageInput.value = '';
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤
                    loadTickets();
                } else {
                    tg.showAlert(data.message || t('errorCreatingTicket'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞:', error);
                tg.showAlert(t('errorCreatingTicket'));
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∞–ª—é—Ç—ã –∏ —è–∑—ã–∫–∞
        async function changeCurrency() {
            const select = document.getElementById('currencySelect');
            const newCurrency = select.value;
            
            if (newCurrency === currentCurrency) return;
            
            currentCurrency = newCurrency;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            await saveSettings({ currency: newCurrency });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤
            if (tariffs.length > 0) {
                renderTariffs();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º userData
            if (userData) {
                userData.preferred_currency = newCurrency;
            }
            
            tg.showAlert(t('currencyChanged'));
        }

        async function changeLanguage() {
            const select = document.getElementById('languageSelect');
            const newLanguage = select.value;
            
            if (newLanguage === currentLanguage) return;
            
            currentLanguage = newLanguage;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            await saveSettings({ lang: newLanguage });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º userData
            if (userData) {
                userData.preferred_lang = newLanguage;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateLanguageUI();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç lang —É html
            document.documentElement.lang = newLanguage;
            
            const langMessages = {
                ru: '–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω',
                ua: '–ú–æ–≤—É –∑–º—ñ–Ω–µ–Ω–æ',
                en: 'Language changed',
                cn: 'ËØ≠Ë®ÄÂ∑≤Êõ¥Êîπ'
            };
            
            tg.showAlert(t('languageChanged'));
        }

        async function saveSettings(settings) {
            try {
                const initData = tg.initData || '';
                const telegramId = getUserFromInitData(initData);
                
                if (!telegramId) {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å telegram_id');
                    return;
                }
                
                const tokenResponse = await fetch('/api/bot/get-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ telegram_id: telegramId })
                });
                
                if (!tokenResponse.ok) {
                    throw new Error(t('errorGettingToken'));
                }
                
                const tokenData = await tokenResponse.json();
                const token = tokenData.token;
                
                const response = await fetch('/api/client/settings', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', errorData);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        loadServerDomain();
        loadData();
    </script>

    <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
    <button id="floatingConnectBtn" class="btn floating-button hidden" onclick="handleConnectClick(event)">
        üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
    </button>
</body>
</html>

